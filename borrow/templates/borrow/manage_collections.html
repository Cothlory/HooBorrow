{% extends 'base.html' %}

{% block content %}
  <h1>Manage Collections</h1>
  
  <h2>Create New Collection</h2>
  <form method="post">
    {% csrf_token %}
    {% if form.non_field_errors %}
      <div class="alert alert-danger">
        {{ form.non_field_errors }}
      </div>
    {% endif %}
    <p>
      {{ form.title.label_tag }}<br>
      {{ form.title }}
    </p>
    <p>
      {{ form.description.label_tag }}<br>
      {{ form.description }}
    </p>
    <p>
      {{ form.items_list.label_tag }}<br>
      {{ form.items_list }}
    </p>
    {% if is_librarian %}
      <p>
        {{ form.is_collection_private.label_tag }}
        {{ form.is_collection_private }}
      </p>
    {% endif %}
    <div id="allowed_users_div">
      <p>
        {{ form.allowed_users.label_tag }}<br>
        {{ form.allowed_users }}
      </p>
    </div>
    <button type="submit">Create Collection</button>
  </form>

  <h2>Your Collections</h2>
  <ul>
    {% for collection in collections %}
      <li>
        <strong>{{ collection.title }}</strong>: {{ collection.description }}
        <a href="{% url 'borrow:edit_collection' collection.pk %}">Edit</a> |
        <a href="{% url 'borrow:delete_collection' collection.pk %}">Delete</a>
      </li>
    {% empty %}
      <li>No collections found.</li>
    {% endfor %}
  </ul>

  {% if is_librarian %}
    <script>
      document.addEventListener('DOMContentLoaded', function(){
        var isPrivateCheckbox = document.getElementById('id_is_collection_private');
        var allowedUsersDiv = document.getElementById('allowed_users_div');
        function toggleAllowedUsers(){
          if(isPrivateCheckbox.checked){
            allowedUsersDiv.style.display = '';
          } else {
            allowedUsersDiv.style.display = 'none';
          }
        }
        isPrivateCheckbox.addEventListener('change', toggleAllowedUsers);
        toggleAllowedUsers();
      });
    </script>
  {% else %}
    <script>
      document.addEventListener('DOMContentLoaded', function(){
        var allowedUsersDiv = document.getElementById('allowed_users_div');
        if(allowedUsersDiv){
          allowedUsersDiv.style.display = 'none';
        }
      });
    </script>
  {% endif %}
{% endblock %}
